# 批量导入订单功能使用说明

## 功能概述

批量导入订单功能允许商家通过 JSON 文件一次性导入多个订单，自动匹配商品和选项，将配送地点信息添加到备注中。

## 使用步骤

### 1. 打开批量导入界面

在订单管理页面，点击"批量导入订单"按钮。

### 2. 下载模板文件

点击"下载 JSON 模板"按钮，获取标准格式的 JSON 模板文件。

### 3. 编辑 JSON 文件

按照以下格式填写订单数据。根据订单场景不同，有两种格式：

#### 格式 1：外带/堂食订单

```json
{
  "orders": [
    {
      "customerInfo": {
        "name": "张三",
        "phone": "13800138000"
      },
      "scene": "外带",
      "deliveryLocation": "北京大学东门",
      "remark": "请快点",
      "items": [
        {
          "productName": "美式咖啡",
          "options": {
            "温度": "热",
            "糖度": "少糖",
            "杯型": "大杯"
          }
        }
      ]
    }
  ]
}
```

#### 格式 2：定时达订单

```json
{
  "orders": [
    {
      "scene": "定时达",
      "deliveryInfo": {
        "school": "咖啡—燕园",
        "address": "#7 图书馆南门",
        "time": "2025-11-20 12:45",
        "number": "18156657202"
      },
      "remark": "需要打包好",
      "items": [
        {
          "productName": "话梅气泡美式",
          "options": {
            "温度": "少冰"
          }
        }
      ]
    }
  ]
}
```

### 4. 字段说明

#### 外带/堂食订单字段

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `customerInfo.name` | String | 否 | 客户姓名，会添加到备注中 |
| `customerInfo.phone` | String | 否 | 客户电话，会添加到备注中 |
| `scene` | String | 是 | 订单场景：`"堂食"` 或 `"外带"` |
| `deliveryLocation` | String | 否 | 配送地点，会添加到备注中 |
| `remark` | String | 否 | 额外备注信息 |
| `items` | Array | 是 | 商品列表，至少包含一个商品 |

#### 定时达订单字段

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `scene` | String | 是 | 必须为 `"定时达"` |
| `deliveryInfo.school` | String | 是 | 学校/地点名称（如 "咖啡—燕园"） |
| `deliveryInfo.address` | String | 是 | 具体送达地址（如 "#7 图书馆南门"） |
| `deliveryInfo.time` | String | 是 | 配送时间，格式 `"YYYY-MM-DD HH:mm"` |
| `deliveryInfo.number` | String | 是 | 联系电话 |
| `remark` | String | 否 | 额外备注信息 |
| `items` | Array | 是 | 商品列表，至少包含一个商品 |

**注意**：定时达订单不需要 `customerInfo` 和 `deliveryLocation` 字段，所有客户信息都在 `deliveryInfo` 中。

#### 商品级别字段

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `productName` | String | 是 | 商品名称，必须与系统中的商品名**完全一致** |
| `options` | Object | 否 | 商品选项（如温度、糖度、杯型等） |

### 5. 选项名称参考

常见的商品选项包括（具体以系统实际配置为准）：

- **温度**: `"热"` / `"冰"` / `"少冰"` / `"正常冰"` / `"去冰"`
- **糖度**: `"无糖"` / `"少糖"` / `"正常糖"` / `"多糖"`
- **杯型**: `"小杯"` / `"中杯"` / `"大杯"`
- **奶油**: `"标准"` / `"多加"` / `"少加"` / `"不加"`

**注意**：选项的名称和值必须与系统中配置的完全一致（区分大小写）。

### 6. 定时达配送时间格式

定时达订单的 `time` 字段可以使用以下两种格式：

#### 格式 1：简单格式（推荐）

```
YYYY-MM-DD HH:mm
```

系统会自动将其转换为标准的 ISO 8601 格式。

**正确示例**：
- `"2025-11-20 12:45"`
- `"2025-11-21 09:30"`
- `"2025-12-01 14:00"`

**错误示例**：
- `"2025/11/20 12:45"` ❌ （使用了斜杠）
- `"11-20 12:45"` ❌ （缺少年份）
- `"2025-11-20"` ❌ （缺少时间）
- `"12:45"` ❌ （缺少日期）

#### 格式 2：ISO 8601 格式（高级）

如果需要精确指定时区，可以使用完整的 ISO 8601 格式：

```
YYYY-MM-DDTHH:mm:ss.sss+08:00
```

**示例**：
- `"2025-11-20T12:45:00.000+08:00"` （北京时间）
- `"2025-11-21T09:30:00+08:00"`

**注意**：对于大多数情况，使用简单格式即可。系统会自动处理时区转换。

### 7. 导入订单

1. 将编辑好的 JSON 内容粘贴到文本框中
2. 点击"开始导入"按钮
3. 系统会显示导入进度和结果

### 8. 查看结果

导入完成后，界面会显示：
- 成功导入的订单数量
- 失败的订单及失败原因
- 每个订单的详细信息

## 完整示例

### 示例 1：外带订单

```json
{
  "orders": [
    {
      "customerInfo": {
        "name": "王小明",
        "phone": "13912345678"
      },
      "scene": "外带",
      "deliveryLocation": "清华大学西门",
      "remark": "打包好一点",
      "items": [
        {
          "productName": "美式咖啡",
          "options": {
            "温度": "热",
            "糖度": "无糖",
            "杯型": "中杯"
          }
        },
        {
          "productName": "拿铁",
          "options": {
            "温度": "冰",
            "糖度": "正常糖",
            "杯型": "大杯"
          }
        }
      ]
    }
  ]
}
```

### 示例 2：堂食订单

```json
{
  "orders": [
    {
      "customerInfo": {
        "name": "李华"
      },
      "scene": "堂食",
      "remark": "需要餐具",
      "items": [
        {
          "productName": "卡布奇诺",
          "options": {
            "温度": "热",
            "糖度": "少糖",
            "杯型": "中杯"
          }
        }
      ]
    }
  ]
}
```

### 示例 3：定时达订单

```json
{
  "orders": [
    {
      "scene": "定时达",
      "deliveryInfo": {
        "school": "咖啡—燕园",
        "address": "#7 图书馆南门",
        "time": "2025-11-20 12:45",
        "number": "18156657202"
      },
      "remark": "需要打包好",
      "items": [
        {
          "productName": "话梅气泡美式",
          "options": {
            "温度": "少冰"
          }
        },
        {
          "productName": "阿婆梅子酪",
          "options": {
            "温度": "少冰"
          }
        }
      ]
    }
  ]
}
```

### 示例 4：混合批量导入（外带+定时达）

### 示例 4：混合批量导入（外带+定时达）

```json
{
  "orders": [
    {
      "customerInfo": {
        "name": "张三",
        "phone": "13800138000"
      },
      "scene": "外带",
      "deliveryLocation": "北大东门",
      "items": [
        {
          "productName": "美式咖啡",
          "options": {
            "温度": "热",
            "杯型": "大杯"
          }
        }
      ]
    },
    {
      "scene": "定时达",
      "deliveryInfo": {
        "school": "咖啡—燕园",
        "address": "#15 宿舍楼下",
        "time": "2025-11-21 14:30",
        "number": "13900139000"
      },
      "remark": "尽快送达",
      "items": [
        {
          "productName": "拿铁",
          "options": {
            "温度": "冰",
            "杯型": "中杯"
          }
        }
      ]
    }
  ]
}
```

## 备注生成规则

### 外带/堂食订单

系统会自动将以下信息组合成订单备注：

```
【配送地点：{deliveryLocation}】【客户：{name}】【电话：{phone}】 {remark}
```

例如，上述示例会生成备注：
```
【配送地点：北京大学东门】【客户：张三】【电话：13800138000】 请快点
```

### 定时达订单

定时达订单的备注只包含用户填写的 `remark` 字段内容，不会自动添加其他信息。客户的联系方式存储在 `deliveryInfo` 中。

## 常见问题

### Q1: 导入失败，提示"找不到商品"

**原因**: 商品名称与系统中的不一致。

**解决方案**:
1. 在商品管理页面查看准确的商品名称
2. 确保 JSON 中的 `productName` 与系统中的完全一致（包括空格、标点）

### Q2: 选项不生效

**原因**: 选项名称或值与系统配置不匹配。

**解决方案**:
1. 在商品选项管理页面查看可用的选项和值
2. 确保 JSON 中的选项名和值与系统中的完全一致

### Q3: 部分订单成功，部分失败

这是正常的。系统会显示每个订单的导入结果，失败的订单不会影响成功的订单。

**操作建议**:
1. 查看失败原因
2. 修正失败的订单数据
3. 重新导入失败的订单

### Q4: 定时达订单导入失败

**原因**: 缺少必填的 `deliveryInfo` 字段。

**解决方案**:
1. 确保 `scene` 字段值为 `"定时达"`
2. 必须包含完整的 `deliveryInfo` 对象：
   - `school`（学校/地点）
   - `address`（具体地址）
   - `time`（配送时间，格式：`YYYY-MM-DD HH:mm`）
   - `number`（联系电话）

### Q5: 如何获取系统中的商品名称和选项？

1. **商品名称**: 访问"商品管理"页面查看
2. **商品选项**: 访问"商品选项"页面查看可用的选项和值
3. **定时达地点**: 访问"地址管理"页面查看可用的学校和地址配置

### Q6: 定时达订单的配送时间有什么限制？

配送时间需要符合系统配置的时段。请联系管理员了解：
- 工作日可选配送时间
- 周末可选配送时间
- 特殊日期的配送安排

## 技术细节

### 商品匹配逻辑

系统使用以下逻辑匹配商品：
1. 精确匹配：`productName === 系统商品名`
2. 模糊匹配：`productName.includes(系统商品名)` 或 `系统商品名.includes(productName)`

### 选项匹配逻辑

系统会遍历所有商品选项：
1. 找到匹配的选项名称
2. 在该选项下找到匹配的值
3. 使用值的 UUID 创建订单

### 错误处理

- 如果商品未找到，该订单会跳过并记录错误
- 如果选项未找到，会输出警告但不会阻止订单创建
- 所有错误都会在导入结果中显示

## 最佳实践

1. **测试导入**: 先用 1-2 个订单测试，确认格式正确后再批量导入
2. **备份数据**: 导入前建议备份现有订单数据
3. **分批导入**: 如果订单数量很多（>100），建议分批导入
4. **验证商品**: 导入前在系统中验证商品名称和选项的准确性
5. **检查结果**: 导入后检查生成的订单，确认信息正确

## 权限要求

使用此功能需要：
- 已登录商家管理后台
- 有创建订单的权限

## 技术支持

如遇到问题，请联系技术支持并提供：
- 使用的 JSON 数据（脱敏后）
- 错误提示截图
- 系统中的商品配置截图
